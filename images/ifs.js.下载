!function(){!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c){var d=!0;try{a.setItem(b,c)}catch(e){d=!1}return d}function e(a){this.journeyId=a,this.storage=window.localStorage}var f="storage",g=a("@ve/utils/domEvents");e.prototype.init=function(a){var b=this,c=null;return b.callback=a,b.isSupported=b.isSupported(),b.isSupported&&(c=b.getJourneyItems(),g.addEvent(window,f,b)),c},e.prototype.handleEvent=function(a){var b,c=new RegExp("^"+this.journeyId+"\\.");a=a||window.event,a.type===f&&c.test(a.key)&&(b=this.getJourneyItems(),"function"==typeof this.callback&&this.callback(b))},e.prototype.isSupported=function(){var a=!1,b="test";try{this.storage.setItem(b,b),this.storage.removeItem(b),a=!0}catch(c){}return a},e.prototype.setItem=function(a,b){var c,e=!1;return this.isSupported&&(c=JSON.stringify(b),e=d(this.storage,this.journeyId+"."+a,c)),e},e.prototype.tryParse=function(a,b){try{return JSON.parse(a)}catch(c){if("SyntaxError"!==c.name)throw c;d(this.storage,b,JSON.stringify(a))}return a},e.prototype.getItem=function(a){a=this.journeyId+"."+a;var b=this.storage.getItem(a);return this.tryParse(b,a)},e.prototype.getJourneyItems=function(){var a,b,c,d,e=null,f=new RegExp("^"+this.journeyId+"\\.");if(this.isSupported)try{for(d=this.storage.length,e={},b=0;b<d;b++)a=this.storage.key(b),f.test(a)&&(c=this.storage.getItem(a),e[a.replace(f,"")]=this.tryParse(c))}catch(g){e=null}return e},e.prototype.removeItem=function(a){this.isSupported&&this.storage.removeItem(this.journeyId+"."+a)},b.exports=e},{"@ve/utils/domEvents":4}],2:[function(a,b,c){"use strict";function d(a,b){var c,d,e={},f=new RegExp("^"+b);for(c in a)f.test(c)&&(d=c.replace(f,""),e[d]=a[c]);return e}function e(a,b,c){var d=b.value,e=a.getItem("sessionId"),f=e===c;f&&b.hasOwnProperty("value")&&b.hasOwnProperty("key")&&a.setItem(c+"."+b.key,d)}function f(a,b,c){b.hasOwnProperty("key")&&a.removeItem(c+"."+b.key)}function g(a,b){this.iframeId=b,this.journeyId=a,this.parentUrl=document.referrer.replace(/^([a-z]*:\/\/[^\/]+).*$/,"$1")||"*"}var h=1,i=2,j=3,k=a("./SharedStorage"),l=a("@ve/utils/domEvents"),m=a("@ve/utils/messageManager");g.prototype.init=function(){this.sharedStorage=new k(this.journeyId),l.addEvent(window,"message",this),m.postMessage(window.parent,{id:this.iframeId,messageBody:"ready"},this.parentUrl)},g.prototype.checkExpiredSession=function(a){var b=this,c=new RegExp("^"+a.sessionId+"\\."),d=a.sessionId!==this.sessionId;return d&&(this.sharedStorage.setItem("sessionId",this.sessionId),Object.keys(a).forEach(function(a){c.test(a)&&b.sharedStorage.removeItem(a)})),d},g.prototype.updateParent=function(a){var b,c=a.sessionId,e=d(a,c+"\\.");c!==this.sessionId&&(e=null),b={id:this.iframeId,messageBody:e},m.postMessage(window.parent,b,this.parentUrl)},g.prototype.handleEvent=function(a){var b,c,d,g=this;switch(a=a||window.event,b=JSON.parse(a.data)||{},b.command){case h:this.sessionId=b.sessionId,c=this.sharedStorage.init(function(a){return g.updateParent(a)}),d=this.checkExpiredSession(c),d&&(c=this.sharedStorage.getJourneyItems()),this.updateParent(c);break;case i:e(this.sharedStorage,b,this.sessionId);break;case j:f(this.sharedStorage,b,this.sessionId)}},b.exports=g},{"./SharedStorage":1,"@ve/utils/domEvents":4,"@ve/utils/messageManager":8}],3:[function(a,b,c){"use strict";var d=a("@ve/utils/domain"),e=a("./StorageCommunicator"),f=d.getQueryParameter("journeyId"),g=d.getQueryParameter("iframeId"),h=new e(f,g);h.init()},{"./StorageCommunicator":2,"@ve/utils/domain":5}],4:[function(a,b,c){"use strict";b.exports={addEvent:function(a,b,c,d){return a.addEventListener?this.addEvent=function(a,b,c,d){return d=!!d,a.addEventListener(b,c,d),!0}:a.attachEvent?this.addEvent=function(a,b,c){return a.attachEvent("on"+b,c),!0}:this.addEvent=function(){return!1},this.addEvent(a,b,c,d)},removeEvent:function(a,b,c,d){return a.removeEventListener?this.removeEvent=function(a,b,c,d){return d=!!d,a.removeEventListener(b,c,d),!0}:a.detachEvent?this.removeEvent=function(a,b,c){return a.detachEvent("on"+b,c),!0}:this.removeEvent=function(){return!1},this.removeEvent(a,b,c,d)},addEventsToArray:function(a,b,c,d){var e,f;if(void 0===a)throw new TypeError("Argument array should not be undefined or NULL.");for(f=a.length>>>0,e=0;e<f;e++)this.addEvent(a[e],b,c,d)},removeEventsFromArray:function(a,b,c,d){var e,f,g=!0,h=!0;if("undefined"==typeof a)throw new TypeError("Argument array should not be undefined or NULL.");for(e=a.length>>>0,f=0;f<e;f++)h=this.removeEvent(a[f],b,c,d),g=!(!h||!g);return g},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,a},getSrcElement:function(a){return a.target||a.srcElement},isOpeningNewWindow:function(a){var b=!1,c=!1;if(a.which)switch(a.which){case 1:b=!0;break;case 2:c=!0}else switch(a.button){case 1:b=!0;break;case 4:c=!0}return c||b&&(a.shiftKey||a.ctrlKey)},checkRightClick:function(a){return a.wich&&3===a.wich||!a.wich&&a.button&&2===a.button}}},{}],5:[function(a,b,c){"use strict";b.exports={isInIframe:function(){return window.location!==window.parent.location},referrerIsInDomains:function(a,b){function c(a,b){for(;d<b.length;d++)if(b[d]=b[d].replace(/\./g,"\\."),e=new RegExp("(^|\\.)"+b[d]+"$"),e.test(a))return!0;return!1}var d=0,e=null;return""===a||0!==b.length&&(a=a.split("/")[2],a=a.replace("www.",""),c(a,b))},getHref:function(){return window.location.href},createUrl:function(a,b,c,d){return b=b||[],c=c||{},b.length>0&&(a+="/"===a[a.length-1]?"":"/",a+=b.map(function(a){return d?encodeURIComponent(a):a}).join("/")),Object.keys(c).length>0&&(a+=a.indexOf("?")!==-1?"&":"?",a+=Object.keys(c).map(function(a){return d?encodeURIComponent(a)+"="+encodeURIComponent(c[a]):a+"="+c[a]}).join("&")),a},getQueryParameter:function(a,b){var c=b?b:window.location.search,d=c.match(new RegExp("[?&]"+a+"=([^&]*)(&?)","i"));return d?decodeURIComponent(d[1]):d},isURL:function(){return!0},recursiveURIDecode:function(a){for(var b="";b!==a;){b=a;try{a=decodeURIComponent(b)}catch(c){return a}}return a},getDomainHost:function(a){var b,c=this,d="";return c.isURL(a)&&(b=document.createElement("a"),b.href=a,d=b.hostname),d},getSearchEngineKeywords:function(){return{google:"q",yahoo:"p",aol:"q",ask:"q",bing:"q",baidu:"wd",yandex:"text"}},getSearchEngineRegExp:function(){var a,b="",c=this.getSearchEngineKeywords();for(a in c)a.hasOwnProperty()||(b=b+"|"+a);return b.replace("|","")},getSearchEngine:function(a){var b,c=new RegExp(".*?(\\.|://)("+this.getSearchEngineRegExp()+")\\..*");return b=!!c.test(a)&&a.replace(c,"$2")},encodeParameter:function(a){return encodeURIComponent(a)}}},{}],6:[function(a,b,c){"use strict";b.exports=function(a){function b(){document.body?document.body.appendChild(a):setTimeout(b,50)}(document.body||document.documentElement).appendChild(a),a.parentElement===document.documentElement&&b()}},{}],7:[function(a,b,c){"use strict";var d=a("./utilsIframe"),e=d().JSON;b.exports={parseJSON:e.parse,stringify:e.stringify}},{"./utilsIframe":9}],8:[function(a,b,c){"use strict";function d(a,b,c){var d=c.indexOf(b)!==-1;return!a||d}var e=function(){},f=a("./domEvents"),g=a("./json"),h={subscriptions:{},init:function(a){function b(a){var b,e,f,j=a.origin.replace(/http(s)?/,""),k={};if(f=g.parseJSON(a.data)||{},e=c.subscriptions[f.id]||[],k.data=f,d(i,j,h))for(b=0;b<e.length;b++)"function"==typeof e[b].callback&&e[b].callback.call(e[b].context,k)}var c=this,h=[],i="*"!==a;i&&(a=a.replace(/http(s)?/,""),h.push(a)),c.subscriptions={},f.addEvent(window,"message",b,!1),c.init=e},subscribeTo:function(a,b,c){this.subscriptions[a]=this.subscriptions[a]||[],this.subscriptions[a].push({callback:b,context:c})},postMessage:function(a,b,c){"string"!=typeof b&&(b=g.stringify(b)),a.postMessage(b,c)},unsubscribeFrom:function(a,b){var c,d=this.subscriptions[a]||[];for(c=d.length-1;c>=0;c--)d[c].callback===b&&d.splice(c,1)}};b.exports=h},{"./domEvents":4,"./json":7}],9:[function(a,b,c){"use strict";function d(){var a=document.createElement("iframe");return a.id=e,a.style.visibility="hidden",a.style.display="none",a.style.border="none",a.width="0",a.height="0",a.tabindex=-1,a}var e="veUtilsIframe",f=void 0===window.veTagData,g=a("./injectIframe");b.exports=function(){var a=f?{contentWindow:window}:document.getElementById(e);return null===a&&(a=d(),g(a)),a.contentWindow}},{"./injectIframe":6}]},{},[3])}();